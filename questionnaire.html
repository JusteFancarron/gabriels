<!DOCTYPE html>
<html lang="fr" data-theme="lemonade">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zéphyr Reïka - Scientifique & Cyber</title>
    <link href="src/css/output.css" rel="stylesheet">
    <style>
        .fade {
            transition: opacity 0.5s ease-in-out;
        }
        .fade-out {
            opacity: 0;
        }
        .fade-in {
            opacity: 1;
        }
        
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        
        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        footer {
            margin-top: auto;
        }
        
        #bruteforce-log {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.8rem;
            padding: 10px;
            background-color: #222;
            color: #0f0;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-base-100">
    <header class="navbar bg-base-300 shadow-lg px-4 sticky top-0 z-50">
        <div class="navbar-start">
            <div class="avatar">
                <div class="w-12 rounded-full">
                    <img src="avatar.jpg" alt="Avatar"/>
                </div>
            </div>
        </div>
        <div class="navbar-center flex">
            <ul class="menu menu-horizontal px-1 flex justify-center gap-4">
                <li><a href="index.html" class="btn btn-ghost normal-case">Accueil</a></li>
                <li><a href="calculatrice.html" class="btn btn-ghost normal-case text-m">Calculatrice</a></li>
                <li><a href="questionnaire.html" class="btn btn-ghost normal-case text-m">Questionnaire</a></li>
            </ul>
        </div>
        <div class="navbar-end">
            <a href="contact.html" class="btn btn-primary">Contact</a>
        </div>
    </header>

    <main>
        <div class="container mx-auto p-4 max-w-md">
            <div class="card bg-base-200 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-center mx-auto mb-4">Questionnaire</h2>
                    
                    <div id="loading-container" class="text-center">
                        <span class="loading loading-spinner loading-lg"></span>
                        <p>Chargement des questions...</p>
                    </div>
                    
                    <div id="quiz-container" class="fade fade-in hidden">
                    </div>
                    
                    <div id="result-container" class="text-center mt-4 hidden">
                        <h3 id="result-message" class="text-xl font-bold mb-4"></h3>
                        <a id="secret-link" href="placeholder.mp4" class="btn btn-primary hidden">Accéder à la page secrète</a>
                    </div>
                    
                    <div class="divider my-4">OU</div>
                    
                    <div id="bruteforce-container" class="text-center">
                        <button id="bruteforce-btn" class="btn btn-secondary" onclick="startBruteforce()">Bruteforce</button>
                        <div id="bruteforce-progress" class="hidden mt-4">
                            <span id="progress-text">Test en cours...</span>
                            <progress class="progress progress-secondary w-full mt-2" id="progress-bar" value="0" max="100"></progress>
                        </div>
                        <div id="bruteforce-log" class="hidden"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer footer-center p-10 bg-neutral text-neutral-content">
        <div class="grid grid-flow-col gap-4">
            <a href="placeholder.mp4" class="link link-hover">À propos</a>
            <a href="contact.html" class="link link-hover">Contact</a>
            <a href="placeholder.mp4" class="link link-hover">Mentions légales</a>
            <a href="placeholder.mp4" class="link link-hover">Confidentialité</a>
        </div>
        <div>
            <div class="grid grid-flow-col gap-4">
                <a href="placeholder.mp4" class="link link-hover"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a>
                <a href="placeholder.mp4" class="link link-hover"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path></svg></a>
                <a href="placeholder.mp4" class="link link-hover"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a>
            </div>
        </div>
        <div>
            <p>Copyright © 2024 EPITA GS - Tous droits réservés.</p>
        </div>
    </footer>

     <script>
        let currentQuestion = 0;
        let correctAnswers = 0;
        let userAnswers = [];
        let questions = [];
        let bruteforceRunning = false;
        let bruteforceStopped = false;
        let currentCombination = [];
        let totalCombinations = 0;
        let testedCombinations = 0;
        let successfulCombination = null;
        
        async function loadQuestions() {
            try {
                const response = await fetch('quizz.json');
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                questions = await response.json();
                
                document.getElementById('loading-container').classList.add('hidden');
                
                document.getElementById('quiz-container').classList.remove('hidden');
                
                displayQuestion(currentQuestion);
                
            } catch (error) {
                console.error('Erreur lors du chargement des questions:', error);
                document.getElementById('loading-container').innerHTML = `
                    <div class="alert alert-error">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Erreur lors du chargement des questions. Veuillez réessayer.</span>
                    </div>
                `;
                
                questions = [
                    {
                        question: "Quel est le langage de programmation le plus utilisé pour le développement web côté client ?",
                        options: ["Java", "Python", "C++", "JavaScript"],
                        answer: 3
                    },
                    {
                        question: "Quelle est la planète la plus proche du soleil ?",
                        options: ["Vénus", "Terre", "Mars", "Mercure"],
                        answer: 3
                    },
                    {
                        question: "Qui a peint la Joconde ?",
                        options: ["Vincent van Gogh", "Pablo Picasso", "Leonardo da Vinci", "Claude Monet"],
                        answer: 2
                    },
                    {
                        question: "Quel est l'élément chimique le plus abondant dans l'univers ?",
                        options: ["Oxygène", "Hydrogène", "Carbone", "Hélium"],
                        answer: 1
                    }
                ];
                
                document.getElementById('loading-container').innerHTML = `
                    <div class="alert alert-warning mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <span>Erreur de chargement, questions par défaut utilisées.</span>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('loading-container').classList.add('hidden');
                    document.getElementById('quiz-container').classList.remove('hidden');
                    displayQuestion(currentQuestion);
                }, 1500);
            }
        }
        
        function displayQuestion(index) {
            const quizContainer = document.getElementById('quiz-container');
            
            if (index >= questions.length) {
                showResults();
                return;
            }
            
            const question = questions[index];
            
            let html = `
                <h3 class="text-lg font-semibold mb-4">${question.question}</h3>
                <div class="grid gap-3">
            `;
            
            question.options.forEach((option, i) => {
                html += `
                    <button class="btn btn-outline" onclick="selectAnswer(${i})">${option}</button>
                `;
            });
            
            html += `</div>`;
            
            quizContainer.innerHTML = html;
        }
        
        function selectAnswer(selectedIndex) {
            const currentQ = questions[currentQuestion];
            
            userAnswers[currentQuestion] = selectedIndex;
            
            if (selectedIndex === currentQ.answer) {
                correctAnswers++;
            }
            
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.classList.add('fade-out');
            
            setTimeout(() => {
                currentQuestion++;
                quizContainer.classList.remove('fade-out');
                displayQuestion(currentQuestion);
            }, 500);
        }
        
        function showResults() {
            const quizContainer = document.getElementById('quiz-container');
            const resultContainer = document.getElementById('result-container');
            const resultMessage = document.getElementById('result-message');
            const secretLink = document.getElementById('secret-link');
            
            quizContainer.classList.add('hidden');
            
            if (correctAnswers === questions.length) {
                resultMessage.textContent = "Vous avez répondu correctement ! Accédez à la page secrète !";
                resultMessage.classList.add('text-success');
                secretLink.classList.remove('hidden');
            } else {
                resultMessage.textContent = "Vous avez échoué.";
                resultMessage.classList.add('text-error');
            }
            
            resultContainer.classList.remove('hidden');
        }
        
        function resetQuiz() {
            currentQuestion = 0;
            correctAnswers = 0;
            userAnswers = [];
            
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            displayQuestion(currentQuestion);
        }
        
        function startBruteforce() {
            if (questions.length === 0) {
                alert("Veuillez attendre le chargement des questions avant de lancer le bruteforce.");
                return;
            }
            
            document.getElementById('bruteforce-btn').classList.add('hidden');
            document.getElementById('bruteforce-progress').classList.remove('hidden');
            document.getElementById('bruteforce-log').classList.remove('hidden');
            document.getElementById('bruteforce-log').innerHTML = "";
            
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('result-container').classList.add('hidden');
            
            bruteforceRunning = true;
            bruteforceStopped = false;
            currentCombination = [];
            totalCombinations = Math.pow(4, questions.length); 
            testedCombinations = 0;
            successfulCombination = null;
            
            logBruteforce("Démarrage du bruteforce...");
            logBruteforce(`Total de combinaisons à tester: ${totalCombinations}`);
            
            setTimeout(() => {
                testNextCombination();
            }, 100);
        }
        
        function stopBruteforce() {
            bruteforceRunning = false;
            bruteforceStopped = true;
            
            document.getElementById('bruteforce-btn').classList.remove('hidden');
            document.getElementById('bruteforce-btn').textContent = "Recommencer le Bruteforce";
            document.getElementById('bruteforce-progress').classList.add('hidden');
            
            logBruteforce("Bruteforce arrêté manuellement.");
        }
        
        function logBruteforce(message) {
            const log = document.getElementById('bruteforce-log');
            const now = new Date();
            const timestamp = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}.${now.getMilliseconds().toString().padStart(3, '0')}]`;
            
            log.innerHTML += `<div>${timestamp} ${message}</div>`;
            log.scrollTop = log.scrollHeight; 
        }
        
        function generateCombination(index) {
            let combination = [];
            let remaining = index;
            
            for (let i = 0; i < questions.length; i++) {
                combination[i] = remaining % 4; 
                remaining = Math.floor(remaining / 4);
            }
            
            return combination;
        }
        
        function testCombination(combination) {
            let correct = true;
            
            for (let i = 0; i < questions.length; i++) {
                if (combination[i] !== questions[i].answer) {
                    correct = false;
                    break;
                }
            }
            
            return correct;
        }
        
        function testNextCombination() {
            if (!bruteforceRunning) return;
            
            let combination = generateCombination(testedCombinations);
            
            let combinationText = combination.map(c => c).join(', ');
            let isCorrect = testCombination(combination);
            
            if (testedCombinations % 100 === 0 || isCorrect) {
                logBruteforce(`Test #${testedCombinations + 1}: [${combinationText}] - ${isCorrect ? 'SUCCÈS ✓' : 'Échec ✗'}`);
            }
            
            testedCombinations++;
            const progressPercent = (testedCombinations / totalCombinations) * 100;
            document.getElementById('progress-bar').value = progressPercent;
            document.getElementById('progress-text').textContent = `Test en cours... ${testedCombinations}/${totalCombinations} (${progressPercent.toFixed(2)}%)`;
            
            if (isCorrect) {
                successfulCombination = combination;
                logBruteforce(`✅ Solution trouvée: [${combinationText}]`);
                finishBruteforce(true);
                return;
            }
            
            if (testedCombinations >= totalCombinations) {
                logBruteforce("❌ Toutes les combinaisons ont été testées sans succès.");
                finishBruteforce(false);
                return;
            }
            
            setTimeout(testNextCombination, 1); 
        }
        
        function finishBruteforce(success) {
            bruteforceRunning = false;
            
            document.getElementById('bruteforce-btn').classList.remove('hidden');
            
            if (success) {
                let solutionDetails = "<div class='mt-4 p-3 bg-success/20 rounded-lg'><strong>Solution trouvée:</strong><br>";
                
                for (let i = 0; i < questions.length; i++) {
                    const option = questions[i].options[successfulCombination[i]];
                    solutionDetails += `Q${i+1}: ${option}<br>`;
                }
                
                solutionDetails += "</div>";
                document.getElementById('bruteforce-log').innerHTML += solutionDetails;
                
                const resultBtn = document.createElement('button');
                resultBtn.className = "btn btn-success mt-4";
                resultBtn.textContent = "Voir le résultat";
                resultBtn.onclick = function() {
                    resetQuiz();
                    simulateBruteforceSuccess();
                };
                
                document.getElementById('bruteforce-progress').innerHTML = "";
                document.getElementById('bruteforce-progress').appendChild(resultBtn);
            } else {
                document.getElementById('bruteforce-progress').innerHTML = `
                    <div class="alert alert-error mt-4">
                        <span>Échec du bruteforce. Aucune solution trouvée.</span>
                    </div>
                `;
            }
        }
        
        function simulateBruteforceSuccess() {
            document.getElementById('bruteforce-progress').classList.add('hidden');
            document.getElementById('bruteforce-log').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            
            simulateClickSequence(0);
        }
        
        function simulateClickSequence(questionIndex) {
            if (questionIndex >= questions.length) return;
            
            displayQuestion(questionIndex);
            
            setTimeout(() => {
                selectAnswer(successfulCombination[questionIndex]);
                
                setTimeout(() => {
                    simulateClickSequence(questionIndex + 1);
                }, 600);
            }, 800);
        }
        
        window.onload = function() {
            loadQuestions();
        };
    </script>
</body>
</html>
